import bcrypt from 'bcryptjs'
import type { Db } from '../state/types'

// NOTE: この seed は「3層フラット構造（Jnavi-代理店-コネクター）」のデモ用データです。
// - 代理店配下にコネクターが並列で紐づきます（コネクター配下にコネクターは存在しません）
// - 「紹介者（introducedById）」は参考データとしてのみ保持します（組織/報酬計算には不使用）

const hash = (plain: string) => bcrypt.hashSync(plain, 10)

export const seedDb: Db = {
  schemaVersion: 4,
  sessionUserId: null,

  users: [
    {
      id: 'usr_admin',
      role: 'J-Navi管理者',
      name: 'Jnavi運営（デモ管理者）',
      email: 'admin@j-navi.test',
      passwordHash: hash('admin123'),
      createdAt: '2026-01-01T00:00:00.000Z',
    },
    // 代理店（Team Leader）
    {
      id: 'usr_agency_a',
      role: '代理店',
      name: '代理店A',
      email: 'agencyA@j-navi.test',
      passwordHash: hash('agency123'),
      createdAt: '2026-01-02T00:00:00.000Z',
      agency: { inviteCode: 'AG-A123' },
    },
    {
      id: 'usr_agency_b',
      role: '代理店',
      name: '代理店B',
      email: 'agencyB@j-navi.test',
      passwordHash: hash('agency123'),
      createdAt: '2026-01-02T00:00:00.000Z',
      agency: { inviteCode: 'AG-B456' },
    },

    // コネクター（Sales / Connector）
    {
      id: 'usr_connector_a',
      role: 'コネクター',
      name: 'コネクターA',
      email: 'connectorA@j-navi.test',
      passwordHash: hash('connector123'),
      createdAt: '2026-01-03T00:00:00.000Z',
      connector: {
        agencyId: 'usr_agency_a',
        introducedById: 'usr_agency_a',
      },
      bankAccount: {
        bankName: 'デモ銀行',
        branchName: '本店',
        accountType: '普通',
        accountNumber: '1234567',
        accountHolder: 'コネクターA',
      },
    },
    {
      id: 'usr_connector_b',
      role: 'コネクター',
      name: 'コネクターB',
      email: 'connectorB@j-navi.test',
      passwordHash: hash('connector123'),
      createdAt: '2026-01-04T00:00:00.000Z',
      connector: {
        agencyId: 'usr_agency_a',
        introducedById: 'usr_connector_a',
      },
    },
    {
      id: 'usr_connector_c',
      role: 'コネクター',
      name: 'コネクターC',
      email: 'connectorC@j-navi.test',
      passwordHash: hash('connector123'),
      createdAt: '2026-01-04T00:00:00.000Z',
      connector: {
        agencyId: 'usr_agency_b',
        introducedById: 'usr_agency_b',
      },
    },
  ],

  suppliers: [
    {
      id: 'sup_001',
      name: 'デモメーカー（サプライヤー）',
      note: '顧客→メーカー入金 / メーカー→Jnaviへ手数料支払い（デモ）',
    },
  ],

  products: [
    {
      id: 'prd_signage_glass',
      supplierId: 'sup_001',
      name: '窓ガラスサイネージ',
      category: 'サイネージ',
      type: 'signage',
      listPriceJPY: 1_000_000,
      description:
        '店舗やオフィスの窓面をサイネージ化する高単価商材。リード→商談→契約→施工完了で売上確定。',
      materials: [
        { label: '提案資料（PDF）', href: 'https://example.com/demo_signage.pdf' },
      ],
      isPublic: true,
    },
    {
      id: 'prd_hotel_member',
      supplierId: 'sup_001',
      name: 'JNホテル会員権',
      category: 'ホテル',
      type: 'hotel_membership',
      listPriceJPY: 300_000,
      description:
        '物販的・即決型の会員権。申し込み→決済完了で売上確定（デモでは即時確定）。',
      materials: [
        { label: '会員権パンフ（PDF）', href: 'https://example.com/demo_hotel.pdf' },
      ],
      isPublic: true,
    },
    {
      id: 'prd_ad_slot',
      supplierId: 'sup_001',
      name: '広告枠',
      category: '広告枠',
      type: 'ad_slot',
      listPriceJPY: 100_000,
      description:
        'ストック型・継続型の広告枠（月額）。申し込み→審査→掲載開始で売上確定（デモは初月分のみ）。',
      materials: [{ label: '媒体資料（PDF）', href: 'https://example.com/demo_ad.pdf' }],
      isPublic: true,
      adSpec: {
        address: '東京都渋谷区（デモ）',
        mapUrl: 'https://maps.google.com',
        size: 'H2000×W3000',
        playbackFrequency: '10秒×6枠/時',
      },
      vacancyStatus: '募集中',
    },
  ],

  deals: [
    // --- 売上確定（施工完了） ---
    {
      id: 'deal_001',
      createdAt: '2026-01-10T10:00:00.000Z',
      locked: true,
      status: '施工完了',
      connectorId: 'usr_connector_b',
      productId: 'prd_signage_glass',
      customerCompanyName: 'デモ不動産株式会社',
      customerName: '山田 太郎',
      customerEmail: 'yamada@example.com',
      customerPhone: '090-0000-0000',
      memo: '窓面の施工スケジュール調整済み（デモ）',
      source: '紹介LP',
      finalSaleAmountJPY: 1_000_000,
      closingDate: '2026-01-15',
    },
    // --- 売上確定（決済完了） ---
    {
      id: 'deal_002',
      createdAt: '2026-01-18T11:00:00.000Z',
      locked: true,
      status: '決済完了',
      connectorId: 'usr_connector_a',
      productId: 'prd_hotel_member',
      customerCompanyName: 'デモ商事株式会社',
      customerName: '佐藤 花子',
      customerEmail: 'sato@example.com',
      memo: 'クレカ決済（デモ）',
      source: '手動',
      finalSaleAmountJPY: 300_000,
      closingDate: '2026-01-20',
    },
    // --- 売上確定（掲載開始） ---
    {
      id: 'deal_003',
      createdAt: '2026-01-22T12:00:00.000Z',
      locked: true,
      status: '掲載開始',
      connectorId: 'usr_connector_c',
      productId: 'prd_ad_slot',
      customerCompanyName: 'デモカフェ株式会社',
      customerName: '鈴木 次郎',
      customerEmail: 'suzuki@example.com',
      memo: '初月掲載開始（デモ）',
      source: '紹介LP',
      finalSaleAmountJPY: 100_000,
      closingDate: '2026-01-25',
    },

    // --- 進行中の商談（デモ） ---
    {
      id: 'deal_004',
      createdAt: '2026-01-28T09:00:00.000Z',
      locked: false,
      status: '商談中',
      connectorId: 'usr_connector_a',
      productId: 'prd_signage_glass',
      customerCompanyName: 'デモ食品株式会社',
      customerName: '高橋 三郎',
      customerEmail: 'takahashi@example.com',
      memo: '現地調査中（デモ）',
      source: '紹介LP',
    },
    {
      id: 'deal_005',
      createdAt: '2026-01-29T09:30:00.000Z',
      locked: false,
      status: '審査',
      connectorId: 'usr_connector_b',
      productId: 'prd_ad_slot',
      customerCompanyName: 'デモ美容株式会社',
      customerName: '中村 四郎',
      customerEmail: 'nakamura@example.com',
      memo: '審査中（デモ）',
      source: '手動',
    },
  ],

  transactions: [
    {
      id: 'tx_001',
      createdAt: '2026-01-15T18:00:00.000Z',
      dealId: 'deal_001',
      closingDate: '2026-01-15',
      productSnapshot: {
        productId: 'prd_signage_glass',
        name: '窓ガラスサイネージ',
        category: 'サイネージ',
        type: 'signage',
        supplierId: 'sup_001',
        listPriceJPY: 1_000_000,
      },
      connectorId: 'usr_connector_b',
      agencyId: 'usr_agency_a',
      saleAmountJPY: 1_000_000,
      baseAmountJPY: 1_000_000,
      ratesUsed: { agencyRate: 0.15, connectorRate: 0.05 },
      agencyRewardJPY: 100_000,
      connectorRewardJPY: 50_000,
      jnaviShareJPY: 850_000,
      allocations: [
        {
          id: 'alloc_tx1_agency',
          recipientType: 'ユーザー報酬',
          userId: 'usr_agency_a',
          userRole: '代理店',
          label: '代理店報酬（10%）',
          rate: 0.10,
          baseAmountJPY: 1_000_000,
          amountJPY: 100_000,
          status: '未確定',
        },
        {
          id: 'alloc_tx1_connector',
          recipientType: 'ユーザー報酬',
          userId: 'usr_connector_b',
          userRole: 'コネクター',
          label: 'コネクター報酬（5%）',
          rate: 0.05,
          baseAmountJPY: 1_000_000,
          amountJPY: 50_000,
          status: '未確定',
        },
        {
          id: 'alloc_tx1_jnavi',
          recipientType: 'Jnavi取り分',
          label: 'Jnavi取り分（残余）',
          amountJPY: 850_000,
        },
      ],
    },
    {
      id: 'tx_002',
      createdAt: '2026-01-20T12:00:00.000Z',
      dealId: 'deal_002',
      closingDate: '2026-01-20',
      productSnapshot: {
        productId: 'prd_hotel_member',
        name: 'JNホテル会員権',
        category: 'ホテル',
        type: 'hotel_membership',
        supplierId: 'sup_001',
        listPriceJPY: 300_000,
      },
      connectorId: 'usr_connector_a',
      agencyId: 'usr_agency_a',
      saleAmountJPY: 300_000,
      baseAmountJPY: 300_000,
      ratesUsed: { agencyRate: 0.15, connectorRate: 0.05 },
      agencyRewardJPY: 30_000,
      connectorRewardJPY: 15_000,
      jnaviShareJPY: 255_000,
      allocations: [
        {
          id: 'alloc_tx2_agency',
          recipientType: 'ユーザー報酬',
          userId: 'usr_agency_a',
          userRole: '代理店',
          label: '代理店報酬（10%）',
          rate: 0.10,
          baseAmountJPY: 300_000,
          amountJPY: 30_000,
          status: '確定',
        },
        {
          id: 'alloc_tx2_connector',
          recipientType: 'ユーザー報酬',
          userId: 'usr_connector_a',
          userRole: 'コネクター',
          label: 'コネクター報酬（5%）',
          rate: 0.05,
          baseAmountJPY: 300_000,
          amountJPY: 15_000,
          status: '確定',
        },
        {
          id: 'alloc_tx2_jnavi',
          recipientType: 'Jnavi取り分',
          label: 'Jnavi取り分（残余）',
          amountJPY: 255_000,
        },
      ],
    },
    {
      id: 'tx_003',
      createdAt: '2026-01-25T12:00:00.000Z',
      dealId: 'deal_003',
      closingDate: '2026-01-25',
      productSnapshot: {
        productId: 'prd_ad_slot',
        name: '広告枠',
        category: '広告枠',
        type: 'ad_slot',
        supplierId: 'sup_001',
        listPriceJPY: 100_000,
      },
      connectorId: 'usr_connector_c',
      agencyId: 'usr_agency_b',
      saleAmountJPY: 100_000,
      baseAmountJPY: 100_000,
      ratesUsed: { agencyRate: 0.15, connectorRate: 0.05 },
      agencyRewardJPY: 10_000,
      connectorRewardJPY: 5_000,
      jnaviShareJPY: 85_000,
      allocations: [
        {
          id: 'alloc_tx3_agency',
          recipientType: 'ユーザー報酬',
          userId: 'usr_agency_b',
          userRole: '代理店',
          label: '代理店報酬（10%）',
          rate: 0.10,
          baseAmountJPY: 100_000,
          amountJPY: 10_000,
          status: '未確定',
        },
        {
          id: 'alloc_tx3_connector',
          recipientType: 'ユーザー報酬',
          userId: 'usr_connector_c',
          userRole: 'コネクター',
          label: 'コネクター報酬（5%）',
          rate: 0.05,
          baseAmountJPY: 100_000,
          amountJPY: 5_000,
          status: '未確定',
        },
        {
          id: 'alloc_tx3_jnavi',
          recipientType: 'Jnavi取り分',
          label: 'Jnavi取り分（残余）',
          amountJPY: 85_000,
        },
      ],
    },
  ],

  payoutRequests: [
    {
      id: 'payout_001',
      userId: 'usr_connector_a',
      requestedAt: '2026-01-21T09:00:00.000Z',
      amountJPY: 15_000,
      status: '申請中',
      allocationIds: ['alloc_tx2_connector'],
    },
  ],

  settings: {
    minPayoutJPY: 5_000,
    agencyRate: 0.15,
    connectorRate: 0.05,
  },

  outbox: [],
  passwordResets: [],

  logs: [
    {
      id: 'log_001',
      at: '2026-01-15T18:00:00.000Z',
      actorUserId: 'usr_admin',
      action: '売上確定',
      detail: 'deal_001 / 窓ガラスサイネージ / 代理店Aに10%、コネクターBに5%',
      relatedId: 'deal_001',
    },
    {
      id: 'log_002',
      at: '2026-01-20T12:00:00.000Z',
      actorUserId: 'usr_admin',
      action: '売上確定',
      detail: 'deal_002 / JNホテル会員権 / 代理店Aに10%、コネクターAに5%',
      relatedId: 'deal_002',
    },
    {
      id: 'log_003',
      at: '2026-01-25T12:00:00.000Z',
      actorUserId: 'usr_admin',
      action: '売上確定',
      detail: 'deal_003 / 広告枠 / 代理店Bに10%、コネクターCに5%',
      relatedId: 'deal_003',
    },
    {
      id: 'log_004',
      at: '2026-01-21T09:00:00.000Z',
      actorUserId: 'usr_connector_a',
      action: '出金申請',
      detail: 'payout_001 / 15,000円',
      relatedId: 'payout_001',
    },
  ],
}
