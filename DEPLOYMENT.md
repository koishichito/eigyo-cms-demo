# デプロイ・ロールバック運用ガイド

このドキュメントは **エンジニアでない運用担当者** 向けです。
ターミナル（黒い画面）でコマンドをコピー&ペーストして実行できれば十分です。

---

## 用語解説

| 用語 | 意味 |
|------|------|
| **リリース** | 新しいバージョンを公開すること |
| **ロールバック** | 問題が起きたとき、前のバージョンに戻すこと |
| **タグ** | コードの特定時点につける「しおり」。`v1.0.0` のような名前 |
| **dist/** | ビルド（コンパイル）されたファイル。これをサーバーに置くと動く |
| **ビルド** | ソースコードを、ブラウザが読める形に変換すること |

---

## 日常の操作

### 今の状態を確認する

```bash
./scripts/status.sh
```

表示される内容:
- 現在のバージョン
- 未保存の変更があるか
- 過去のリリース一覧
- バックアップの一覧

### 新しいバージョンをリリースする

```bash
./scripts/release.sh 1.0.0
```

バージョン番号のルール:
- `1.0.0` → 最初の正式版
- `1.0.1` → 小さな修正
- `1.1.0` → 機能追加
- `2.0.0` → 大きな変更

**リリースすると何が起きるか:**
1. コードが正しくビルドできるかチェック
2. タグ（しおり）がつく
3. `releases/` フォルダにバックアップが保存される

### 問題が起きたとき — ロールバック

**1つ前のバージョンに戻す（最も簡単）:**
```bash
./scripts/rollback.sh
```

**特定のバージョンに戻す:**
```bash
./scripts/rollback.sh v1.0.0
```

**戻せるバージョンの一覧を見る:**
```bash
./scripts/rollback.sh --list
```

---

## 緊急時の手順

### 「デプロイしたら画面が真っ白になった」

1. 慌てない
2. ロールバックする:
   ```bash
   ./scripts/rollback.sh
   ```
3. `dist/` が前のバージョンに戻る
4. その `dist/` を再デプロイする
5. 落ち着いてから原因を調査

### 「ロールバックもうまくいかない」

最終手段 — デモ版（開発開始時点）に戻す:
```bash
./scripts/rollback.sh v0.3.0-demo
```

これで最初のデモ版に戻れます。

---

## バージョン履歴

| バージョン | 日付 | 内容 |
|-----------|------|------|
| v0.3.0-demo | 2026-02-07 | 初期デモ版。ロールバックの最終安全地点 |

※ リリースするたびにこの表に追記してください。

---

## スクリプト一覧

| スクリプト | 用途 | 危険度 |
|-----------|------|--------|
| `./scripts/status.sh` | 状態確認（見るだけ） | 安全 |
| `./scripts/release.sh` | 新バージョンのリリース | 低（タグをつけるだけ） |
| `./scripts/rollback.sh` | 前のバージョンに戻す | 中（dist/が入れ替わる） |

---

## 注意事項

- リリース前に必ず `./scripts/status.sh` で状態を確認する
- ロールバック後は必ずデプロイし直す（dist/ が変わっただけではサーバーには反映されない）
- `releases/` フォルダはバックアップなので削除しない
- 困ったときは `./scripts/rollback.sh --list` で戻れるバージョンを確認
